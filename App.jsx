import React, { useState, useCallback, useRef, useEffect } from "react";

const PEOPLE=[{id:"p1",name:"Eli",email:"eli@3la.co",color:"#e94560"},{id:"p2",name:"Luke",email:"luke@3la.co",color:"#3b82f6"},{id:"p3",name:"Michael",email:"michael@3la.co",color:"#0f9b8e"},{id:"p4",name:"Arya",email:"arya@3la.co",color:"#8b5cf6"}];

const INIT=[{id:"trak",name:"Trak",color:"#e94560",projects:[{id:"tp",name:"Production",status:"on-track",statusText:"POs are in",timeline:"5/15 Launch",startDate:"2026-02-01",endDate:"2026-05-15",tags:["p1"],notes:"",attachments:[],subprojects:[{id:"s1",name:"Sampling & China Visit",tags:["p1"],notes:"",attachments:[],startDate:"2026-02-01",endDate:"2026-03-15",tasks:[{id:"t1",text:"Confirm sampling date and China visit date",done:false,priority:"high",due:"2026-02-27",tags:["p1"],notes:"",attachments:[]}]}]},{id:"tc",name:"Commercial",status:"on-track",statusText:"Planning phase",timeline:"5/1 Launch",startDate:"2026-02-10",endDate:"2026-05-01",tags:["p1"],notes:"",attachments:[],subprojects:[{id:"s2",name:"Launch Campaign",tags:[],notes:"",attachments:[],startDate:"2026-02-10",endDate:"2026-04-01",tasks:[{id:"t2",text:"Launch campaign pre-production",done:false,priority:"high",due:"2026-03-01",tags:["p1"],notes:"",attachments:[]},{id:"t3",text:"Coming Soon page up",done:false,priority:"high",due:"2026-02-28",tags:[],notes:"",attachments:[]}]},{id:"s3",name:"Partnerships",tags:[],notes:"",attachments:[],startDate:"2026-03-01",endDate:"2026-05-01",tasks:[{id:"t4",text:"Outreach to athletes and partners",done:false,priority:"medium",due:"2026-03-07",tags:[],notes:"",attachments:[]}]}]},{id:"ti",name:"Innovation",status:"on-track",statusText:"Roadmap aligned",timeline:"Ongoing",startDate:"2026-01-15",endDate:"2026-06-30",tags:["p2"],notes:"",attachments:[],subprojects:[{id:"s4",name:"Innovation Brief",tags:["p3"],notes:"",attachments:[],startDate:"2026-02-01",endDate:"2026-03-30",tasks:[{id:"t5",text:"Connect with Michael regarding innovation brief",done:false,priority:"medium",due:"2026-02-27",tags:["p3"],notes:"",attachments:[]}]},{id:"s5",name:"Footwear Prototype",tags:["p2"],notes:"",attachments:[],startDate:"2026-02-15",endDate:"2026-05-15",tasks:[{id:"t6",text:"Luke prototype footwear",done:false,priority:"high",due:"2026-03-15",tags:["p2"],notes:"",attachments:[]}]}]}]},{id:"rados",name:"Rados",color:"#f5a623",projects:[{id:"rp",name:"Production",status:"at-risk",statusText:"Production-Ready",timeline:"TBD",startDate:"2026-02-01",endDate:"2026-04-30",tags:[],notes:"",attachments:[],subprojects:[{id:"s6",name:"Renders & PI",tags:[],notes:"",attachments:[],startDate:"2026-02-01",endDate:"2026-03-15",tasks:[{id:"t7",text:"Render for PI",done:false,priority:"medium",due:"2026-03-01",tags:[],notes:"",attachments:[]}]}]}]},{id:"fo",name:"Family Office",color:"#0f9b8e",projects:[{id:"fm",name:"Merchandise",status:"at-risk",statusText:"Quarter Zip complete",timeline:"Ongoing",startDate:"2026-01-01",endDate:"2026-06-30",tags:["p1"],notes:"",attachments:[],subprojects:[{id:"s7",name:"Quarter Zip Launch",tags:[],notes:"",attachments:[],startDate:"2026-01-15",endDate:"2026-03-01",tasks:[{id:"t8",text:"Launch quarter-zip",done:false,priority:"high",due:"2026-02-25",tags:["p1"],notes:"",attachments:[]}]},{id:"s8",name:"Hat Restock",tags:[],notes:"",attachments:[],startDate:"2026-02-01",endDate:"2026-04-01",tasks:[{id:"t9",text:"Embroiderer to re-do hats",done:false,priority:"high",due:"2026-03-01",tags:[],notes:"",attachments:[]}]}]},{id:"fc",name:"Commercial",status:"on-track",statusText:"Webstore & IG live",timeline:"Ongoing",startDate:"2026-01-15",endDate:"2026-06-30",tags:[],notes:"",attachments:[],subprojects:[{id:"s9",name:"Content & Social",tags:[],notes:"",attachments:[],startDate:"2026-02-01",endDate:"2026-05-01",tasks:[{id:"t10",text:"New content promoting merchandise",done:false,priority:"medium",due:"2026-02-27",tags:[],notes:"",attachments:[]},{id:"t11",text:"Outreach for collab posts",done:false,priority:"medium",due:"2026-03-05",tags:[],notes:"",attachments:[]}]}]},{id:"fb",name:"Beverage",status:"on-track",statusText:"Liquid complete",timeline:"Late Spring 2026",startDate:"2026-02-01",endDate:"2026-06-15",tags:[],notes:"",attachments:[],subprojects:[{id:"s10",name:"Formula & Production",tags:[],notes:"",attachments:[],startDate:"2026-02-01",endDate:"2026-04-15",tasks:[{id:"t12",text:"Pay invoice to handover formula",done:false,priority:"high",due:"2026-02-25",tags:[],notes:"",attachments:[]},{id:"t13",text:"Lock in production time",done:false,priority:"high",due:"2026-03-01",tags:[],notes:"",attachments:[]},{id:"t14",text:"Reach out to ingredient suppliers",done:false,priority:"medium",due:"2026-03-07",tags:[],notes:"",attachments:[]}]},{id:"s11",name:"Packaging",tags:[],notes:"",attachments:[],startDate:"2026-03-01",endDate:"2026-05-01",tasks:[{id:"t15",text:"Send can design",done:false,priority:"medium",due:"2026-03-01",tags:[],notes:"",attachments:[]}]}]}]},{id:"vesper",name:"Vesper Lab",color:"#8b5cf6",projects:[{id:"vp",name:"Prototype",status:"at-risk",statusText:"Prototype in progress",timeline:"TBD",startDate:"2026-02-01",endDate:"2026-05-30",tags:[],notes:"",attachments:[],subprojects:[{id:"s12",name:"Core Prototype",tags:[],notes:"",attachments:[],startDate:"2026-02-01",endDate:"2026-04-30",tasks:[{id:"t16",text:"Ongoing work to complete prototype",done:false,priority:"high",due:"2026-03-15",tags:[],notes:"",attachments:[]}]}]}]},{id:"design",name:"3LA Design",color:"#3b82f6",projects:[{id:"dw",name:"Website",status:"on-track",statusText:"V1 nearly complete",timeline:"Ongoing",startDate:"2026-01-01",endDate:"2026-04-30",tags:[],notes:"",attachments:[],subprojects:[{id:"s13",name:"V1 Build",tags:[],notes:"",attachments:[],startDate:"2026-01-15",endDate:"2026-03-30",tasks:[{id:"t18",text:"V1 website edits",done:false,priority:"high",due:"2026-03-01",tags:[],notes:"",attachments:[]}]}]},{id:"dp",name:"Product Development",status:"on-track",statusText:"Titanium and Valenki in development",timeline:"Ongoing",startDate:"2026-01-15",endDate:"2026-06-30",tags:["p2"],notes:"",attachments:[],subprojects:[{id:"s14",name:"Partnerships & Talent",tags:[],notes:"",attachments:[],startDate:"2026-02-01",endDate:"2026-04-01",tasks:[{id:"t17",text:"Sign Arya",done:false,priority:"high",due:"2026-02-27",tags:["p4"],notes:"",attachments:[]}]},{id:"s15",name:"Factory & Manufacturing",tags:["p2"],notes:"",attachments:[],startDate:"2026-02-15",endDate:"2026-05-15",tasks:[{id:"t19",text:"Luke send fork instructions to factory",done:false,priority:"medium",due:"2026-03-05",tags:["p2"],notes:"",attachments:[]}]},{id:"s16",name:"Surfboard",tags:[],notes:"",attachments:[],startDate:"2026-03-01",endDate:"2026-06-01",tasks:[{id:"t20",text:"Surfboard vendor search",done:false,priority:"low",due:"2026-03-15",tags:[],notes:"",attachments:[]}]}]}]}];
const ST={"on-track":{l:"On Track",c:"#0f9b8e"},"at-risk":{l:"At Risk",c:"#f5a623"},blocked:{l:"Blocked",c:"#e94560"},complete:{l:"Complete",c:"#6b7280"}};
const PR={high:{l:"High",c:"#e94560",s:0},medium:{l:"Med",c:"#f5a623",s:1},low:{l:"Low",c:"#6b7280",s:2}};
const CL=["#e94560","#f5a623","#0f9b8e","#8b5cf6","#3b82f6","#ec4899","#14b8a6","#f97316"];
const du=d=>{const now=new Date();now.setHours(0,0,0,0);return Math.round((new Date(d+"T00:00:00")-now)/864e5)};
const fm=d=>new Date(d+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"});
const dba=(a,b)=>Math.round((new Date(b+"T00:00:00")-new Date(a+"T00:00:00"))/864e5);
const uid=()=>"_"+Math.random().toString(36).slice(2,9);
const pn=id=>PEOPLE.find(p=>p.id===id);
const addDays=(d,n)=>{const x=new Date(d+"T00:00:00");x.setDate(x.getDate()+n);const y=x.getFullYear(),m=String(x.getMonth()+1).padStart(2,"0"),dy=String(x.getDate()).padStart(2,"0");return `${y}-${m}-${dy}`};
const gAll=data=>{const o=[];data.forEach(c=>c.projects.forEach(p=>p.subprojects.forEach(s=>s.tasks.forEach(t=>o.push({...t,catId:c.id,catName:c.name,catColor:c.color,projId:p.id,projName:p.name,projTags:p.tags||[],spId:s.id,spName:s.name,spTags:s.tags||[]})))));return o};
const css={bg:"#08080e",card:"#111119",bdr:"#1a1a24",sub:"#0d0d14"};
const GS="2026-01-01",GE="2026-07-01",TD=dba(GS,GE);
const LS_D="3la_data",LS_P="3la_people";
const load=(k,fb)=>{try{if(typeof localStorage==="undefined")return fb;const v=localStorage.getItem(k);if(!v)return fb;const p=JSON.parse(v);if(k===LS_D&&(!Array.isArray(p)||!p[0]?.projects))return fb;if(k===LS_P&&(!Array.isArray(p)||!p[0]?.name))return fb;return p}catch(e){return fb}};
const save=(k,v)=>{try{if(typeof localStorage!=="undefined")localStorage.setItem(k,JSON.stringify(v))}catch(e){}};
const B=({children,bg,color:c})=><span style={{fontSize:9,fontWeight:650,padding:"2px 7px",borderRadius:6,background:bg,color:c,whiteSpace:"nowrap"}}>{children}</span>;
const Ch=({on,color:c,onClick})=><div onClick={onClick} style={{width:17,height:17,borderRadius:5,border:on?"none":"2px solid #333",background:on?c:"transparent",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0}}>{on&&<span style={{color:"#fff",fontSize:10,fontWeight:800}}>‚úì</span>}</div>;
const Br=({p,color:c,h=3})=><div style={{flex:1,height:h,background:css.bdr,borderRadius:h,overflow:"hidden"}}><div style={{width:`${Math.min(100,p)}%`,height:"100%",background:c,borderRadius:h}}/></div>;
const Du=({due:d,done})=>{if(done)return <span style={{fontSize:10,color:"#444"}}>Done</span>;const v=du(d);return <span style={{fontSize:10,color:v<0?"#e94560":v<=3?"#f5a623":"#555",fontWeight:v<=3?650:400}}>{v<0?Math.abs(v)+"d late":v===0?"Today":v+"d"}</span>};
const Bt=({children,accent:a,onClick,sx})=><div onClick={onClick} style={{display:"inline-flex",alignItems:"center",gap:4,padding:"5px 10px",background:a?a+"18":"#1a1a28",border:`1px solid ${a?a+"30":"#252536"}`,borderRadius:6,cursor:"pointer",fontSize:10,color:a||"#888",fontWeight:600,...sx}}>{children}</div>;
const vd=v=>v&&/^\d{4}-\d{2}-\d{2}$/.test(v)&&parseInt(v.slice(0,4))>1999;
const In=({style:sx,onChange:oc,type:tp,...r})=>{
  const handleChange=tp==="date"?(e=>{if(vd(e.target.value)&&oc)oc(e)}):oc;
  return <input {...r} type={tp} onChange={handleChange} style={{background:css.bg,border:"1px solid #1e1e2e",borderRadius:5,padding:"6px 9px",color:"#ddd",fontSize:11,outline:"none",...sx}}/>
};
const Se=({children,...r})=><select {...r} style={{background:css.bg,border:"1px solid #1e1e2e",borderRadius:5,padding:"6px 7px",color:"#aaa",fontSize:10}}>{children}</select>;
function IE({value:val,onSave,style:sx}){const[e,sE]=useState(false);const[v,sV]=useState(val);if(!e)return <span onDoubleClick={()=>{sV(val);sE(true)}} style={{cursor:"pointer",...sx}} title="Double-click to edit">{val}</span>;return <input autoFocus value={v} onChange={e=>sV(e.target.value)} onBlur={()=>{if(v.trim()&&v!==val)onSave(v.trim());sE(false)}} onKeyDown={e=>{if(e.key==="Enter"){if(v.trim())onSave(v.trim());sE(false)}if(e.key==="Escape")sE(false)}} style={{background:css.bg,border:"1px solid #e94560",borderRadius:4,padding:"2px 6px",color:"#ddd",fontSize:"inherit",fontWeight:"inherit",outline:"none",width:"100%"}}/>}
function DB({onConfirm}){const[c,sC]=useState(false);if(!c)return <span onClick={e=>{e.stopPropagation();sC(true)}} style={{fontSize:10,color:"#555",cursor:"pointer",padding:"2px 4px"}}>‚úï</span>;return <span onClick={e=>e.stopPropagation()} style={{fontSize:9,display:"inline-flex",gap:4}}><span style={{color:"#e94560",cursor:"pointer",fontWeight:600}} onClick={()=>{onConfirm();sC(false)}}>Yes</span><span style={{color:"#555",cursor:"pointer"}} onClick={()=>sC(false)}>No</span></span>}
function Tags({tags=[],small}){if(!tags.length)return null;return <div style={{display:"flex",gap:2,flexWrap:"wrap"}}>{tags.map(id=>{const p=pn(id);return p?<span key={id} style={{fontSize:small?7.5:8.5,fontWeight:600,padding:small?"1px 4px":"1px 5px",borderRadius:4,background:p.color+"20",color:p.color,whiteSpace:"nowrap"}}>{p.name}</span>:null})}</div>}
function TP({tags=[],onChange,people:pp}){const[open,setOpen]=useState(false);return <div style={{position:"relative",display:"inline-flex"}}><span onClick={()=>setOpen(!open)} style={{fontSize:10,color:"#555",cursor:"pointer",padding:"2px 6px",background:"#1a1a28",borderRadius:4,border:"1px solid #252536"}}>üë§{tags.length>0?` ${tags.length}`:""}</span>{open&&<div style={{position:"absolute",top:"100%",left:0,zIndex:50,background:css.card,border:"1px solid "+css.bdr,borderRadius:8,padding:6,minWidth:140,marginTop:4,boxShadow:"0 8px 24px #0008"}}><div style={{fontSize:9,color:"#555",fontWeight:600,marginBottom:4,padding:"0 4px"}}>Tag people</div>{(pp||PEOPLE).map(p=><div key={p.id} onClick={()=>{const n=tags.includes(p.id)?tags.filter(x=>x!==p.id):[...tags,p.id];onChange(n)}} style={{display:"flex",alignItems:"center",gap:6,padding:"4px 6px",borderRadius:4,cursor:"pointer",background:tags.includes(p.id)?p.color+"15":"transparent",marginBottom:1}}><div style={{width:6,height:6,borderRadius:3,background:p.color}}/><span style={{fontSize:10.5,color:tags.includes(p.id)?p.color:"#888",fontWeight:tags.includes(p.id)?600:400}}>{p.name}</span>{tags.includes(p.id)&&<span style={{marginLeft:"auto",fontSize:9,color:p.color}}>‚úì</span>}</div>)}<div style={{borderTop:"1px solid "+css.bdr,marginTop:4,paddingTop:4}}><span onClick={()=>setOpen(false)} style={{fontSize:9,color:"#555",cursor:"pointer",padding:"2px 6px"}}>Done</span></div></div>}</div>}
function NP({notes,attachments=[],onNotesChange,onAddAttachment,onRemoveAttachment}){const[open,setOpen]=useState(false);const[an,setAn]=useState("");const hasContent=(notes&&notes.length>0)||(attachments&&attachments.length>0);return <div style={{marginTop:4}}><span onClick={(e)=>{e.stopPropagation();setOpen(!open)}} style={{fontSize:9,color:hasContent?"#888":"#444",cursor:"pointer",display:"inline-flex",alignItems:"center",gap:3}}>{open?"‚ñæ":"‚ñ∏"} {hasContent?"üìù Notes":"üìé Add notes"} {attachments.length>0&&`(${attachments.length})`}</span>{open&&<div style={{marginTop:6,padding:"8px 10px",background:css.bg,borderRadius:6,border:"1px solid #1e1e2e"}} onClick={e=>e.stopPropagation()}><textarea defaultValue={notes||""} onBlur={e=>onNotesChange(e.target.value)} placeholder="Add notes... (saves on blur)" style={{background:"#0c0c14",border:"1px solid #1e1e2e",borderRadius:5,padding:"6px 9px",color:"#ddd",fontSize:11,outline:"none",resize:"vertical",minHeight:60,width:"100%",fontFamily:"inherit",display:"block",boxSizing:"border-box"}}/><div style={{fontSize:9,color:"#555",fontWeight:600,marginBottom:4,marginTop:8}}>Attachments</div>{attachments.map((a,i)=><div key={i} style={{display:"flex",alignItems:"center",gap:6,padding:"3px 0",fontSize:10}}><span style={{color:"#3b82f6"}}>üìé</span><span style={{color:"#aaa",flex:1}}>{a.name}</span><span onClick={()=>onRemoveAttachment(i)} style={{color:"#555",cursor:"pointer",fontSize:9}}>‚úï</span></div>)}<div style={{display:"flex",gap:4,marginTop:4}}><In value={an} onChange={e=>setAn(e.target.value)} placeholder="Link or filename..." style={{flex:1,fontSize:10,padding:"4px 7px"}} onKeyDown={e=>{if(e.key==="Enter"&&an.trim()){onAddAttachment({name:an.trim(),url:an.trim().startsWith("http")?an.trim():""});setAn("")}}}/><Bt sx={{padding:"3px 8px",fontSize:9}} onClick={()=>{if(an.trim()){onAddAttachment({name:an.trim(),url:an.trim().startsWith("http")?an.trim():""});setAn("")}}}>Add</Bt></div></div>}</div>}
function Mo({title:ti,content:co,onClose}){const[cp,sC]=useState(false);return <div style={{position:"fixed",inset:0,background:"#000c",zIndex:100,display:"flex",alignItems:"center",justifyContent:"center",padding:20}} onClick={onClose}><div onClick={e=>e.stopPropagation()} style={{background:css.card,border:"1px solid #1e1e2e",borderRadius:14,width:"100%",maxWidth:560,maxHeight:"80vh",display:"flex",flexDirection:"column",overflow:"hidden"}}><div style={{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"14px 18px",borderBottom:"1px solid "+css.bdr}}><span style={{fontSize:13,fontWeight:700,color:"#e0e0ea"}}>{ti}</span><div style={{display:"flex",gap:6,alignItems:"center"}}>{cp&&<span style={{fontSize:10,color:"#0f9b8e",fontWeight:600}}>‚úì</span>}<Bt onClick={()=>{navigator.clipboard.writeText(co);sC(true);setTimeout(()=>sC(false),2e3)}}>üìã</Bt><Bt accent="#e94560" onClick={()=>window.open(`mailto:?subject=${encodeURIComponent(ti)}&body=${encodeURIComponent(co)}`)}>‚úâ</Bt><span onClick={onClose} style={{cursor:"pointer",color:"#555",fontSize:16}}>‚úï</span></div></div><pre style={{flex:1,overflow:"auto",padding:"14px 18px",margin:0,fontSize:10.5,lineHeight:1.6,color:"#b0b0bc",fontFamily:"monospace",whiteSpace:"pre-wrap",background:css.bg}}>{co}</pre></div></div>}
function eP(c,p){const at=[];p.subprojects.forEach(s=>s.tasks.forEach(t=>at.push(t)));const d=at.filter(t=>t.done).length;const pc=at.length?Math.round(d/at.length*100):0;let t=`${c.name} > ${p.name}\n${ST[p.status].l} | ${d}/${at.length} (${pc}%) | ${p.timeline}\n`;if(p.notes)t+=`Notes: ${p.notes}\n`;t+="\n";p.subprojects.forEach(sp=>{const sd=sp.tasks.filter(x=>x.done).length;t+=`  ${sp.name} (${sd}/${sp.tasks.length})\n`;if(sp.notes)t+=`  Notes: ${sp.notes}\n`;sp.tasks.forEach(x=>{t+=`  ${x.done?"[x]":"[ ]"} [${x.priority.toUpperCase()}] ${x.text} - ${fm(x.due)}\n`});t+="\n"});return t}
function bD(gs,n,data,fP){const ov=gs.find(g=>g.t==="Overdue")?.items||[];const td=gs.find(g=>g.t==="Due Today")?.items||[];const wk=gs.find(g=>g.t==="This Week")?.items||[];const fc=ov.length+td.length;const pName=fP?pn(fP)?.name:"";let b=`3LA DIGEST${fP?` - ${pName}`:""}\n${new Date().toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"})}\n\nTODAY\n`;if(!ov.length&&!td.length&&!wk.length)b+="  All clear!\n";else{if(ov.length){b+="  OVERDUE:\n";ov.forEach(t=>b+=`    ${t.text} (${Math.abs(du(t.due))}d)\n`)}if(td.length){b+="  DUE TODAY:\n";td.forEach(t=>b+=`    ${t.text}\n`)}if(wk.length){b+=`  This week: ${wk.length}\n`;wk.slice(0,3).forEach(t=>b+=`    ${t.text} (${fm(t.due)})\n`)}}b+="\nALL TASKS\n";gs.forEach(g=>{if(!g.items.length)return;b+=`\n${g.t.toUpperCase()} (${g.items.length})\n`;g.items.forEach(t=>b+=`  [${t.priority.toUpperCase()}] ${t.text} - ${fm(t.due)}\n`)});return{subject:fc>0?`3LA${fP?` (${pName})`:""} - ${fc} urgent`:`3LA${fP?` (${pName})`:""} - ${n} pending`,body:b}}
function PM({people,setPeople}){const[show,setShow]=useState(false);const[nn,setNn]=useState("");const[ne,setNe]=useState("");const[editing,setEditing]=useState(null);const[en,setEn]=useState("");const[ee,setEe]=useState("");return <div style={{position:"relative",display:"inline-flex"}}><span onClick={()=>setShow(!show)} style={{fontSize:10,color:"#888",cursor:"pointer",padding:"5px 10px",background:"#1a1a28",border:"1px solid #252536",borderRadius:6,display:"inline-flex",alignItems:"center",gap:4,fontWeight:600}}>üë• ({people.length})</span>{show&&<div style={{position:"absolute",top:"100%",right:0,zIndex:60,background:css.card,border:"1px solid "+css.bdr,borderRadius:10,padding:10,minWidth:260,marginTop:4,boxShadow:"0 8px 24px #0008"}}><div style={{fontSize:10,fontWeight:650,color:"#888",marginBottom:6}}>Team</div>{people.map(p=>editing===p.id?<div key={p.id} style={{display:"flex",gap:4,alignItems:"center",padding:"4px 2px",flexWrap:"wrap"}}><div style={{width:8,height:8,borderRadius:4,background:p.color}}/><In value={en} onChange={e=>setEn(e.target.value)} style={{flex:1,fontSize:10,padding:"3px 6px",minWidth:60}}/><In value={ee} onChange={e=>setEe(e.target.value)} style={{flex:1,fontSize:10,padding:"3px 6px",minWidth:80}}/><span onClick={()=>{setPeople(ps=>ps.map(x=>x.id!==editing?x:{...x,name:en.trim()||x.name,email:ee.trim()}));setEditing(null)}} style={{fontSize:9,color:"#0f9b8e",cursor:"pointer",fontWeight:600}}>‚úì</span><span onClick={()=>setEditing(null)} style={{fontSize:9,color:"#555",cursor:"pointer"}}>‚úï</span></div>:<div key={p.id} style={{display:"flex",alignItems:"center",gap:6,padding:"4px 2px"}}><div style={{width:8,height:8,borderRadius:4,background:p.color}}/><span style={{fontSize:11,color:"#ccc",flex:1}}>{p.name}</span><span style={{fontSize:9,color:"#555"}}>{p.email}</span><span onClick={()=>{setEditing(p.id);setEn(p.name);setEe(p.email)}} style={{fontSize:9,color:"#555",cursor:"pointer"}}>‚úé</span><DB onConfirm={()=>setPeople(ps=>ps.filter(x=>x.id!==p.id))}/></div>)}<div style={{borderTop:"1px solid "+css.bdr,marginTop:6,paddingTop:6,display:"flex",gap:4,flexWrap:"wrap"}}><In value={nn} onChange={e=>setNn(e.target.value)} placeholder="Name" style={{flex:1,fontSize:10,padding:"4px 7px",minWidth:70}}/><In value={ne} onChange={e=>setNe(e.target.value)} placeholder="Email" style={{flex:1,fontSize:10,padding:"4px 7px",minWidth:80}}/><Bt sx={{padding:"3px 8px",fontSize:9}} accent="#0f9b8e" onClick={()=>{if(nn.trim()){setPeople(p=>[...p,{id:uid(),name:nn.trim(),email:ne.trim(),color:CL[p.length%CL.length]}]);setNn("");setNe("")}}}>+</Bt></div><div style={{marginTop:6,textAlign:"right"}}><span onClick={()=>setShow(false)} style={{fontSize:9,color:"#555",cursor:"pointer"}}>Close</span></div></div>}</div>}
export default function App(){
  const[data,setData]=useState(()=>load(LS_D,INIT));const[people,setPeople]=useState(()=>load(LS_P,PEOPLE));const[view,setView]=useState("status");const[detail,setDetail]=useState(null);const[showAdd,setShowAdd]=useState(false);const[af,setAf]=useState({text:"",catId:"",projId:"",spId:"",priority:"medium",due:"2026-03-01",tags:[]});const[drag,setDrag]=useState(null);
  useEffect(()=>save(LS_D,data),[data]);useEffect(()=>save(LS_P,people),[people]);
  useEffect(()=>{if(!drag)return;const onM=e=>{const dx=e.clientX-drag.startX;const dd=Math.round((dx/drag.chartW)*TD);if(drag.row.type==="proj"){if(drag.edge==="left")uProj(drag.row.catId,drag.row.id,p=>({...p,startDate:addDays(drag.origSd,dd)}));else if(drag.edge==="right")uProj(drag.row.catId,drag.row.id,p=>({...p,endDate:addDays(drag.origEd,dd)}));else{uProj(drag.row.catId,drag.row.id,p=>({...p,startDate:addDays(drag.origSd,dd),endDate:addDays(drag.origEd,dd)}))}}else if(drag.row.type==="sp"){if(drag.edge==="left")uSP(drag.row.catId,drag.row.projId,drag.row.id,s=>({...s,startDate:addDays(drag.origSd,dd)}));else if(drag.edge==="right")uSP(drag.row.catId,drag.row.projId,drag.row.id,s=>({...s,endDate:addDays(drag.origEd,dd)}));else{uSP(drag.row.catId,drag.row.projId,drag.row.id,s=>({...s,startDate:addDays(drag.origSd,dd),endDate:addDays(drag.origEd,dd)}))}}else{uTask(drag.row.catId,drag.row.projId,drag.row.spId,drag.row.id,t=>({...t,due:addDays(drag.origSd,dd)}))}};const onU=()=>setDrag(null);window.addEventListener("mousemove",onM);window.addEventListener("mouseup",onU);return()=>{window.removeEventListener("mousemove",onM);window.removeEventListener("mouseup",onU)}},[drag]);
  const tog=useCallback((ci,pi,si,ti)=>setData(d=>d.map(c=>c.id!==ci?c:{...c,projects:c.projects.map(p=>p.id!==pi?p:{...p,subprojects:p.subprojects.map(s=>s.id!==si?s:{...s,tasks:s.tasks.map(t=>t.id!==ti?t:{...t,done:!t.done})})})})),[]);
  const dT=(ci,pi,si,ti)=>setData(d=>d.map(c=>c.id!==ci?c:{...c,projects:c.projects.map(p=>p.id!==pi?p:{...p,subprojects:p.subprojects.map(s=>s.id!==si?s:{...s,tasks:s.tasks.filter(t=>t.id!==ti)})})}));
  const uTask=(ci,pi,si,ti,fn)=>setData(d=>d.map(c=>c.id!==ci?c:{...c,projects:c.projects.map(p=>p.id!==pi?p:{...p,subprojects:p.subprojects.map(s=>s.id!==si?s:{...s,tasks:s.tasks.map(t=>t.id!==ti?t:fn(t))})})}));
  const uSP=(ci,pi,si,fn)=>setData(d=>d.map(c=>c.id!==ci?c:{...c,projects:c.projects.map(p=>p.id!==pi?p:{...p,subprojects:p.subprojects.map(s=>s.id!==si?s:fn(s))})}));
  const uProj=(ci,pi,fn)=>setData(d=>d.map(c=>c.id!==ci?c:{...c,projects:c.projects.map(p=>p.id!==pi?p:fn(p))}));
  const doAdd=()=>{const f=af;if(!f.text||!f.catId||!f.projId||!f.spId)return;setData(d=>d.map(c=>c.id!==f.catId?c:{...c,projects:c.projects.map(p=>p.id!==f.projId?p:{...p,subprojects:p.subprojects.map(s=>s.id!==f.spId?s:{...s,tasks:[...s.tasks,{id:uid(),text:f.text,done:false,priority:f.priority,due:f.due,tags:f.tags||[],notes:"",attachments:[]}]})})}));setAf({text:"",catId:"",projId:"",spId:"",priority:"medium",due:"2026-03-01",tags:[]});setShowAdd(false)};
  const scp=af.catId?data.find(c=>c.id===af.catId)?.projects||[]:[];const sps=af.projId?scp.find(p=>p.id===af.projId)?.subprojects||[]:[];
  const all=gAll(data);const tot=all.length;const dn=all.filter(t=>t.done).length;const urg=all.filter(t=>!t.done&&du(t.due)<=3).length;
  const dc=detail?data.find(c=>c.id===detail.catId):null;const dp=dc?dc.projects.find(p=>p.id===detail.projId):null;
  const VW=[{k:"status",l:"Status",i:"‚óé"},{k:"tasks",l:"Tasks",i:"‚òê"},{k:"reminders",l:"Reminders",i:"‚è∞"},{k:"gantt",l:"Timeline",i:"‚ñ¨"}];
  function SV(){
    const[ex,sEx]=useState({});const[mo,sMo]=useState(null);const[aC,sAC]=useState(false);const[nC,sNC]=useState("");const[nCo,sNCo]=useState("#e94560");const[aP,sAP]=useState(null);const[nP,sNP]=useState({n:"",tl:"TBD",s:"2026-03-01",e:"2026-06-30"});const[aSP,sASP]=useState(null);const[nSP,sNSP]=useState("");
    const tg=id=>sEx(p=>({...p,[id]:p[id]===undefined?false:!p[id]}));
    return <div style={{display:"grid",gap:20}}>
      {mo&&<Mo {...mo} onClose={()=>sMo(null)}/>}
      {data.map(cat=>{const at=[];cat.projects.forEach(p=>p.subprojects.forEach(s=>s.tasks.forEach(t=>at.push(t))));const d=at.filter(t=>t.done).length;const p=at.length?(d/at.length)*100:0;const ur=at.filter(t=>!t.done&&du(t.due)<=3).length;
        return <div key={cat.id}>
          <div style={{display:"flex",alignItems:"center",gap:8,marginBottom:8}}>
            <span onClick={()=>tg(cat.id)} style={{fontSize:9,color:"#555",cursor:"pointer",transform:ex[cat.id]===false?"rotate(-90deg)":"",display:"inline-block",transition:"transform .2s"}}>‚ñº</span>
            <div style={{width:8,height:8,borderRadius:2,background:cat.color}}/>
            <IE value={cat.name} onSave={n=>setData(d=>d.map(c=>c.id!==cat.id?c:{...c,name:n}))} style={{fontSize:13,fontWeight:700,color:"#e0e0ea"}}/>
            <div style={{flex:1,display:"flex",alignItems:"center",gap:8}}><Br p={p} color={cat.color}/><span style={{fontSize:9.5,color:"#555"}}>{d}/{at.length}</span></div>
            {ur>0&&<B bg="#e9456020" color="#e94560">{ur} urgent</B>}
            <span onClick={()=>sAP(aP===cat.id?null:cat.id)} style={{fontSize:10,color:cat.color,cursor:"pointer",fontWeight:600}}>+ Project</span>
            <DB onConfirm={()=>setData(d=>d.filter(c=>c.id!==cat.id))}/>
          </div>
          {aP===cat.id&&<div style={{display:"flex",gap:6,marginBottom:8,marginLeft:20,flexWrap:"wrap",alignItems:"center"}}><In value={nP.n} onChange={e=>sNP({...nP,n:e.target.value})} placeholder="Project name..." style={{flex:1,minWidth:140}}/><In value={nP.tl} onChange={e=>sNP({...nP,tl:e.target.value})} placeholder="Timeline" style={{width:90}}/><In type="date" value={nP.s} onChange={e=>sNP({...nP,s:e.target.value})} style={{width:130}}/><In type="date" value={nP.e} onChange={e=>sNP({...nP,e:e.target.value})} style={{width:130}}/><Bt accent={cat.color} onClick={()=>{if(!nP.n.trim())return;setData(d=>d.map(c=>c.id!==cat.id?c:{...c,projects:[...c.projects,{id:uid(),name:nP.n.trim(),status:"on-track",statusText:"",timeline:nP.tl,startDate:nP.s,endDate:nP.e,tags:[],notes:"",attachments:[],subprojects:[]}]}));sNP({n:"",tl:"TBD",s:"2026-03-01",e:"2026-06-30"});sAP(null)}}>Add</Bt></div>}
          {ex[cat.id]!==false&&<div style={{display:"grid",gap:6,paddingLeft:20}}>
            {cat.projects.map(proj=>{const pt=[];proj.subprojects.forEach(s=>s.tasks.forEach(t=>pt.push(t)));const pd=pt.filter(t=>t.done).length;const pp=pt.length?(pd/pt.length)*100:0;const st=ST[proj.status];
              return <div key={proj.id} style={{background:css.card,border:"1px solid "+css.bdr,borderRadius:10,overflow:"hidden",borderLeft:`3px solid ${cat.color}`}}>
                <div style={{padding:"11px 14px",cursor:"pointer"}} onClick={()=>tg(proj.id)}>
                  <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:4}}>
                    <div style={{display:"flex",alignItems:"center",gap:7,flex:1}} onClick={e=>e.stopPropagation()}>
                      <span style={{fontSize:8,color:"#555",transform:ex[proj.id]===false?"rotate(-90deg)":"",display:"inline-block"}} onClick={()=>tg(proj.id)}>‚ñº</span>
                      <div style={{flex:1}} onDoubleClick={e=>e.stopPropagation()}><IE value={proj.name} onSave={n=>uProj(cat.id,proj.id,p=>({...p,name:n}))} style={{fontSize:13,fontWeight:600,color:"#dddde6"}}/><IE value={proj.statusText||"..."} onSave={n=>uProj(cat.id,proj.id,p=>({...p,statusText:n}))} style={{fontSize:10,color:"#666",marginTop:1,display:"block"}}/><Tags tags={proj.tags}/></div></div>
                    <div style={{display:"flex",alignItems:"center",gap:5,flexShrink:0}} onClick={e=>e.stopPropagation()}>
                      <TP tags={proj.tags||[]} onChange={t=>uProj(cat.id,proj.id,p=>({...p,tags:t}))} people={people}/>
                      <Bt sx={{padding:"3px 8px",fontSize:9}} onClick={()=>setDetail({catId:cat.id,projId:proj.id})}>‚ñ∂</Bt>
                      <Bt sx={{padding:"3px 8px",fontSize:9}} onClick={()=>sMo({title:`${cat.name} ‚Ä∫ ${proj.name}`,content:eP(cat,proj)})}>‚Üó</Bt>
                      <B bg={st.c+"18"} color={st.c}>{st.l}</B>
                      <DB onConfirm={()=>setData(d=>d.map(c=>c.id!==cat.id?c:{...c,projects:c.projects.filter(p=>p.id!==proj.id)}))}/></div></div>
                  <div style={{display:"flex",alignItems:"center",gap:8,marginTop:6}}><Br p={pp} color={cat.color}/><span style={{fontSize:9.5,color:"#555"}}>{pd}/{pt.length}</span></div></div>
                {ex[proj.id]!==false&&<div style={{borderTop:"1px solid "+css.bdr}}>
                  {proj.subprojects.map(sp=>{const sd=sp.tasks.filter(t=>t.done).length;const spp=sp.tasks.length?(sd/sp.tasks.length)*100:0;
                    return <div key={sp.id} style={{borderBottom:"1px solid #14141e"}}>
                      <div onClick={()=>tg(sp.id)} style={{display:"flex",alignItems:"center",gap:8,padding:"8px 14px 8px 28px",cursor:"pointer",background:css.sub}}>
                        <span style={{fontSize:7,color:"#444",transform:ex[sp.id]===false?"rotate(-90deg)":"",display:"inline-block"}}>‚ñº</span>
                        <div style={{flex:1}} onClick={e=>e.stopPropagation()} onDoubleClick={e=>e.stopPropagation()}><IE value={sp.name} onSave={n=>uSP(cat.id,proj.id,sp.id,s=>({...s,name:n}))} style={{fontSize:11.5,fontWeight:600,color:"#b0b0bc"}}/><Tags tags={sp.tags} small/></div>
                        <span onClick={e=>e.stopPropagation()}><TP tags={sp.tags||[]} onChange={t=>uSP(cat.id,proj.id,sp.id,s=>({...s,tags:t}))} people={people}/></span>
                        <div style={{width:40}}><Br p={spp} color={cat.color} h={2}/></div><span style={{fontSize:9,color:"#555"}}>{sd}/{sp.tasks.length}</span>
                        <span onClick={e=>e.stopPropagation()}><DB onConfirm={()=>setData(d=>d.map(c=>c.id!==cat.id?c:{...c,projects:c.projects.map(p=>p.id!==proj.id?p:{...p,subprojects:p.subprojects.filter(s=>s.id!==sp.id)})}))}/></span></div>
                      {ex[sp.id]!==false&&<div style={{padding:"4px 14px 8px 44px"}}>
                        <div onClick={e=>e.stopPropagation()} style={{marginBottom:4}}><NP notes={sp.notes} attachments={sp.attachments||[]} onNotesChange={n=>uSP(cat.id,proj.id,sp.id,s=>({...s,notes:n}))} onAddAttachment={a=>uSP(cat.id,proj.id,sp.id,s=>({...s,attachments:[...(s.attachments||[]),a]}))} onRemoveAttachment={i=>uSP(cat.id,proj.id,sp.id,s=>({...s,attachments:(s.attachments||[]).filter((_,j)=>j!==i)}))}/></div>
                        {sp.tasks.map(t=><div key={t.id} style={{opacity:t.done?.4:1,marginBottom:2}}>
                          <div style={{display:"flex",alignItems:"center",gap:8,padding:"5px 0"}}>
                            <Ch on={t.done} color={cat.color} onClick={()=>tog(cat.id,proj.id,sp.id,t.id)}/>
                            <span style={{flex:1,fontSize:11.5,color:t.done?"#555":"#c8c8d4",textDecoration:t.done?"line-through":"none"}}>{t.text}</span>
                            <Tags tags={t.tags} small/><TP tags={t.tags||[]} onChange={tg=>uTask(cat.id,proj.id,sp.id,t.id,x=>({...x,tags:tg}))} people={people}/>
                            <In type="date" value={t.due} onChange={e=>uTask(cat.id,proj.id,sp.id,t.id,x=>({...x,due:e.target.value}))} style={{width:120,fontSize:9,padding:"2px 4px"}}/>
                            <B bg={PR[t.priority].c+"1a"} color={PR[t.priority].c}>{PR[t.priority].l}</B>
                            <Du due={t.due} done={t.done}/><DB onConfirm={()=>dT(cat.id,proj.id,sp.id,t.id)}/></div>
                          <div style={{paddingLeft:25}}><NP notes={t.notes} attachments={t.attachments||[]} onNotesChange={n=>uTask(cat.id,proj.id,sp.id,t.id,x=>({...x,notes:n}))} onAddAttachment={a=>uTask(cat.id,proj.id,sp.id,t.id,x=>({...x,attachments:[...(x.attachments||[]),a]}))} onRemoveAttachment={i=>uTask(cat.id,proj.id,sp.id,t.id,x=>({...x,attachments:(x.attachments||[]).filter((_,j)=>j!==i)}))}/></div></div>)}</div>}</div>})}
                  <div style={{padding:"6px 28px",background:css.sub}}><span onClick={()=>sASP(aSP===proj.id?null:proj.id)} style={{fontSize:10,color:"#444",cursor:"pointer"}}>+ Sub-project</span></div>
                  {aSP===proj.id&&<div style={{display:"flex",gap:6,padding:"6px 28px 10px",background:css.sub}}><In value={nSP} onChange={e=>sNSP(e.target.value)} placeholder="Sub-project name..." style={{flex:1}} onKeyDown={e=>{if(e.key==="Enter"&&nSP.trim()){setData(d=>d.map(c=>c.id!==cat.id?c:{...c,projects:c.projects.map(p=>p.id!==proj.id?p:{...p,subprojects:[...p.subprojects,{id:uid(),name:nSP.trim(),tags:[],notes:"",attachments:[],startDate:proj.startDate,endDate:proj.endDate,tasks:[]}]})}));sNSP("");sASP(null)}}}/><Bt accent={cat.color} onClick={()=>{if(!nSP.trim())return;setData(d=>d.map(c=>c.id!==cat.id?c:{...c,projects:c.projects.map(p=>p.id!==proj.id?p:{...p,subprojects:[...p.subprojects,{id:uid(),name:nSP.trim(),tags:[],notes:"",attachments:[],startDate:proj.startDate,endDate:proj.endDate,tasks:[]}]})}));sNSP("");sASP(null)}}>Add</Bt></div>}
                </div>}</div>})}</div>}</div>})}
      {!aC?<div onClick={()=>sAC(true)} style={{padding:"10px",border:"1px dashed #1e1e2e",borderRadius:10,cursor:"pointer",fontSize:11,color:"#555",textAlign:"center",fontWeight:600}}>+ Add Category</div>
      :<div style={{display:"flex",gap:6,alignItems:"center",flexWrap:"wrap"}}><In value={nC} onChange={e=>sNC(e.target.value)} placeholder="Category..." style={{flex:1,minWidth:140}}/><div style={{display:"flex",gap:3}}>{CL.map(c=><div key={c} onClick={()=>sNCo(c)} style={{width:18,height:18,borderRadius:4,background:c,cursor:"pointer",border:nCo===c?"2px solid #fff":"2px solid transparent"}}/>)}</div><Bt accent={nCo} onClick={()=>{if(nC.trim()){setData(d=>[...d,{id:uid(),name:nC.trim(),color:nCo,projects:[]}]);sNC("");sAC(false)}}}>Add</Bt><span onClick={()=>sAC(false)} style={{color:"#555",cursor:"pointer"}}>‚úï</span></div>}</div>}
  function TV(){const al=gAll(data);const pe=al.filter(t=>!t.done).sort((a,b)=>PR[a.priority].s-PR[b.priority].s||new Date(a.due)-new Date(b.due));const done=al.filter(t=>t.done);
    return <div><div style={{fontSize:10,fontWeight:650,letterSpacing:1.5,textTransform:"uppercase",color:"#777",marginBottom:8}}>Pending ({pe.length})</div>
      {pe.map(t=><div key={t.id} style={{display:"flex",alignItems:"center",gap:9,padding:"8px 12px",background:"#0e0e16",borderRadius:7,marginBottom:4}}><Ch on={false} color={t.catColor} onClick={()=>tog(t.catId,t.projId,t.spId,t.id)}/><div style={{flex:1}}><div style={{fontSize:12,color:"#d0d0da"}}>{t.text}</div><div style={{fontSize:9.5,color:"#4a4a5a",marginTop:1}}>{t.catName} ‚Ä∫ {t.projName} ‚Ä∫ {t.spName}</div></div><Tags tags={t.tags} small/><B bg={PR[t.priority].c+"1a"} color={PR[t.priority].c}>{PR[t.priority].l}</B><Du due={t.due} done={false}/></div>)}
      {done.length>0&&<><div style={{fontSize:10,fontWeight:650,letterSpacing:1.5,textTransform:"uppercase",color:"#444",marginBottom:8,marginTop:20}}>Completed ({done.length})</div>{done.map(t=><div key={t.id} style={{display:"flex",alignItems:"center",gap:9,padding:"8px 12px",background:"#0e0e16",borderRadius:7,marginBottom:4,opacity:.45}}><Ch on={true} color={t.catColor} onClick={()=>tog(t.catId,t.projId,t.spId,t.id)}/><div style={{flex:1}}><div style={{fontSize:12,color:"#555",textDecoration:"line-through"}}>{t.text}</div></div></div>)}</>}</div>}
  function RV(){const[fb,sFb]=useState(null);const[fP,sFP]=useState(null);let al=gAll(data).filter(t=>!t.done);if(fP)al=al.filter(t=>(t.tags||[]).includes(fP)||(t.projTags||[]).includes(fP)||(t.spTags||[]).includes(fP));al.sort((a,b)=>new Date(a.due)-new Date(b.due));const gs=[{t:"Overdue",items:al.filter(t=>du(t.due)<0),a:"#e94560",e:"üö®"},{t:"Due Today",items:al.filter(t=>du(t.due)===0),a:"#f5a623",e:"‚ö°"},{t:"This Week",items:al.filter(t=>{const v=du(t.due);return v>0&&v<=7}),a:"#0f9b8e",e:"üìã"},{t:"Next Week",items:al.filter(t=>{const v=du(t.due);return v>7&&v<=14}),a:"#3b82f6",e:"üìÖ"},{t:"Later",items:al.filter(t=>du(t.due)>14),a:"#555",e:"üóì"}];const sh=m=>{sFb(m);setTimeout(()=>sFb(null),2500)};
    return <div>
      <div style={{display:"flex",alignItems:"center",gap:8,marginBottom:16,padding:"12px 14px",background:css.card,border:"1px solid "+css.bdr,borderRadius:10,flexWrap:"wrap"}}>
        <div style={{flex:1,display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"}}>{gs[0].items.length>0&&<span style={{fontSize:11,color:"#e94560",fontWeight:650}}>{gs[0].items.length} overdue</span>}{gs[1].items.length>0&&<span style={{fontSize:11,color:"#f5a623",fontWeight:650}}>{gs[1].items.length} today</span>}<span style={{fontSize:11,color:"#888"}}>{gs[2].items.length} this week</span></div>
        <div style={{display:"flex",gap:4,alignItems:"center",flexWrap:"wrap"}}><span style={{fontSize:9,color:"#555",fontWeight:600}}>Filter:</span><span onClick={()=>sFP(null)} style={{fontSize:9,padding:"2px 8px",borderRadius:4,cursor:"pointer",background:!fP?"#252536":"transparent",color:!fP?"#ddd":"#555",fontWeight:600}}>All</span>{people.map(p=><span key={p.id} onClick={()=>sFP(fP===p.id?null:p.id)} style={{fontSize:9,padding:"2px 8px",borderRadius:4,cursor:"pointer",background:fP===p.id?p.color+"25":"transparent",color:fP===p.id?p.color:"#555",fontWeight:600}}>{p.name}</span>)}</div>
        <div style={{display:"flex",gap:6}}>{fb&&<span style={{fontSize:10,color:"#0f9b8e",fontWeight:600}}>‚úì {fb}</span>}<Bt onClick={()=>{const{subject:s,body:b}=bD(gs,al.length,data,fP);navigator.clipboard.writeText(`Subject: ${s}\n\n${b}`).then(()=>sh("Copied"))}}>üìã</Bt><Bt accent="#e94560" onClick={()=>{const{subject:s,body:b}=bD(gs,al.length,data,fP);const toEmail=fP?pn(fP)?.email:"";window.open(`mailto:${toEmail}?subject=${encodeURIComponent(s)}&body=${encodeURIComponent(b)}`);sh("Opened")}}>‚úâ{fP?` ${pn(fP)?.name}`:""}</Bt></div></div>
      {gs.map(g=>!g.items.length?null:<div key={g.t} style={{marginBottom:20}}><div style={{display:"flex",alignItems:"center",gap:6,marginBottom:8}}><div style={{width:6,height:6,borderRadius:3,background:g.a}}/><span style={{fontSize:10,fontWeight:650,letterSpacing:1.5,textTransform:"uppercase",color:g.a}}>{g.t} ({g.items.length})</span></div>{g.items.map(t=><div key={t.id} style={{display:"flex",alignItems:"center",gap:10,padding:"9px 13px",background:css.card,border:"1px solid "+css.bdr,borderRadius:8,marginBottom:5,borderLeft:`3px solid ${g.a}`}}><div style={{flex:1}}><div style={{fontSize:12,color:"#d0d0da"}}>{t.text}</div><div style={{fontSize:9.5,color:"#4a4a5a",marginTop:1}}>{t.catName} ‚Ä∫ {t.projName} ‚Ä∫ {t.spName} ¬∑ {fm(t.due)}</div></div><Tags tags={t.tags} small/><B bg={PR[t.priority].c+"1a"} color={PR[t.priority].c}>{PR[t.priority].l}</B><Du due={t.due} done={false}/></div>)}</div>)}</div>}
  function GV(){
    const[mo,sMo]=useState(null);const[fC,sFC]=useState(null);const[fP,sFP]=useState(null);const chartRef=useRef(null);
    const today=new Date();today.setHours(0,0,0,0);const todayStr=today.getFullYear()+"-"+String(today.getMonth()+1).padStart(2,"0")+"-"+String(today.getDate()).padStart(2,"0");const TOD=dba(GS,todayStr);
    const ms=[{n:"Jan",d:31},{n:"Feb",d:28},{n:"Mar",d:31},{n:"Apr",d:30},{n:"May",d:31},{n:"Jun",d:30}];
    const fd=fC?data.filter(c=>c.id===fC):data;const allProjs=[];fd.forEach(c=>c.projects.forEach(p=>allProjs.push({c,p})));const rows=[];
    fd.forEach(c=>c.projects.forEach(p=>{if(fP&&p.id!==fP)return;const at=[];p.subprojects.forEach(s=>s.tasks.forEach(t=>at.push(t)));const pc=at.length?(at.filter(t=>t.done).length/at.length)*100:0;rows.push({type:"proj",c,p,pc,sd:p.startDate,ed:p.endDate,label:`${c.name} ‚Ä∫ ${p.name}`,id:p.id,catId:c.id});p.subprojects.forEach(s=>{const sp=s.tasks.length?(s.tasks.filter(t=>t.done).length/s.tasks.length)*100:0;rows.push({type:"sp",c,p,s,pc:sp,sd:s.startDate||p.startDate,ed:s.endDate||p.endDate,label:s.name,id:s.id,catId:c.id,projId:p.id});s.tasks.forEach(t=>{rows.push({type:"task",c,p,s,t,pc:t.done?100:0,sd:t.due,ed:t.due,label:t.text,id:t.id,catId:c.id,projId:p.id,spId:s.id})})})}));
    const LW=220;
    const hmd=(e,row,edge)=>{e.preventDefault();e.stopPropagation();const el=chartRef.current;if(!el)return;const r=el.getBoundingClientRect();setDrag({row,edge,startX:e.clientX,chartW:r.width-LW,origSd:row.sd,origEd:row.ed})};
    return <div>{mo&&<Mo {...mo} onClose={()=>sMo(null)}/>}
      <div style={{display:"flex",alignItems:"center",gap:6,marginBottom:6,flexWrap:"wrap"}}><Bt sx={{padding:"4px 10px",...(!fC&&!fP?{background:"#252536",color:"#ddd"}:{})}} onClick={()=>{sFC(null);sFP(null)}}>All</Bt>{data.map(c=><Bt key={c.id} sx={{padding:"4px 10px",...(fC===c.id?{background:c.color+"25",color:c.color}:{})}} onClick={()=>{sFC(fC===c.id?null:c.id);sFP(null)}}>{c.name}</Bt>)}<div style={{flex:1}}/><Bt onClick={()=>{let t="3LA TIMELINE\n\n";fd.forEach(c=>c.projects.forEach(p=>{if(fP&&p.id!==fP)return;t+=`${c.name} > ${p.name} (${p.startDate} to ${p.endDate})\n`;p.subprojects.forEach(s=>{t+=`  ${s.name} (${s.startDate||"?"} to ${s.endDate||"?"})\n`;s.tasks.forEach(x=>t+=`    ${x.done?"[x]":"[ ]"} ${x.text} - ${x.due}\n`)});t+="\n"}));sMo({title:"Timeline",content:t})}}>‚Üó</Bt><span style={{fontSize:8,color:"#444"}}>Drag bars to resize</span></div>
      {allProjs.length>1&&<div style={{display:"flex",alignItems:"center",gap:4,marginBottom:10,flexWrap:"wrap",paddingLeft:4}}><span style={{fontSize:9,color:"#444",fontWeight:600}}>Project:</span><span onClick={()=>sFP(null)} style={{fontSize:9,padding:"2px 8px",borderRadius:4,cursor:"pointer",background:!fP?"#252536":"transparent",color:!fP?"#ccc":"#555",fontWeight:600}}>All</span>{allProjs.map(({c,p})=><span key={p.id} onClick={()=>sFP(fP===p.id?null:p.id)} style={{fontSize:9,padding:"2px 8px",borderRadius:4,cursor:"pointer",background:fP===p.id?c.color+"25":"transparent",color:fP===p.id?c.color:"#555",fontWeight:fP===p.id?600:400}}>{p.name}</span>)}</div>}
      <div style={{overflowX:"auto",paddingBottom:12,paddingTop:20}} ref={chartRef}><div style={{minWidth:900}}>
        <div style={{display:"flex",marginLeft:LW,marginBottom:6}}>{ms.map(m=><div key={m.n} style={{width:`${m.d/TD*100}%`,fontSize:9.5,fontWeight:650,color:"#555",letterSpacing:1.2,textTransform:"uppercase",paddingLeft:4,borderLeft:"1px solid "+css.bdr}}>{m.n}</div>)}</div>
        <div style={{position:"relative"}}>
          <div style={{position:"absolute",left:`calc(${LW}px + ${TOD/TD*100}%)`,top:-6,bottom:0,width:2,background:"#e94560",opacity:.8,zIndex:15}}/>
          <div style={{position:"absolute",left:`calc(${LW}px + ${TOD/TD*100}% - 22px)`,top:-28,fontSize:9,color:"#fff",fontWeight:750,zIndex:16,background:"#e94560",padding:"2px 6px",borderRadius:4}}>TODAY</div>
          {rows.map((r,i)=>{const rh=r.type==="proj"?30:r.type==="sp"?24:20;const bh=r.type==="proj"?14:r.type==="sp"?10:6;const so=dba(GS,r.sd);const eo=dba(GS,r.ed);const dur=Math.max(eo-so,1);const lP=so/TD*100;const wP=dur/TD*100;const col=r.c.color;
            return <div key={`${r.type}-${r.id}-${i}`} style={{display:"flex",alignItems:"center",height:rh,borderBottom:"1px solid #12121a"}}>
              <div style={{width:LW,flexShrink:0,paddingRight:10,paddingLeft:r.type==="proj"?0:r.type==="sp"?16:32,overflow:"hidden"}}><div style={{fontSize:r.type==="proj"?11:r.type==="sp"?10:9,color:r.type==="proj"?"#ccc":r.type==="sp"?"#999":"#666",fontWeight:r.type==="proj"?600:r.type==="sp"?500:400,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",display:"flex",alignItems:"center",gap:5}}>{r.type==="proj"&&<div style={{width:6,height:6,borderRadius:2,background:col}}/>}{r.type==="task"&&<div style={{width:4,height:4,borderRadius:2,background:r.t?.done?"#333":PR[r.t?.priority||"medium"].c}}/>}{r.label}</div></div>
              <div style={{flex:1,position:"relative",height:"100%"}}>
                {r.type==="task"?<div onMouseDown={e=>hmd(e,r,"move")} style={{position:"absolute",left:`calc(${lP}% - 5px)`,top:(rh-10)/2,width:10,height:10,borderRadius:5,background:r.t?.done?"#333":PR[r.t?.priority||"medium"].c,cursor:"ew-resize",zIndex:3,border:`2px solid ${css.bg}`}} title={`${r.label} ‚Äî ${fm(r.sd)}`}/>
                :<><div style={{position:"absolute",left:`${lP}%`,width:`${wP}%`,top:(rh-bh)/2,height:bh,background:col+"33",borderRadius:bh/2,border:`1px solid ${col}40`,overflow:"hidden",cursor:"grab"}} onMouseDown={e=>hmd(e,r,"move")}><div style={{width:`${r.pc}%`,height:"100%",background:col+"aa",borderRadius:bh/2}}/></div>
                  <div onMouseDown={e=>hmd(e,r,"left")} style={{position:"absolute",left:`${lP}%`,top:(rh-bh)/2-2,width:6,height:bh+4,cursor:"w-resize",zIndex:4}}/>
                  <div onMouseDown={e=>hmd(e,r,"right")} style={{position:"absolute",left:`calc(${lP+wP}% - 6px)`,top:(rh-bh)/2-2,width:6,height:bh+4,cursor:"e-resize",zIndex:4}}/>
                  <div style={{position:"absolute",left:`${lP}%`,top:rh-10,fontSize:7,color:"#444",pointerEvents:"none"}}>{fm(r.sd)}</div>
                  <div style={{position:"absolute",left:`${lP+wP}%`,top:rh-10,fontSize:7,color:"#444",pointerEvents:"none",transform:"translateX(-100%)"}}>{fm(r.ed)}</div></>}
              </div></div>})}
        </div></div></div></div>}
  function DV(){const[aSP,sASP]=useState(false);const[spN,sSN]=useState("");const[spSD,sSD]=useState("");const[spED,sED]=useState("");const[aT,sAT]=useState(null);const[tN,sTN]=useState("");const[tP,sTP]=useState("medium");const[tDu,sTD]=useState("2026-03-15");const[tTg,sTTg]=useState([]);const[mo,sMo]=useState(null);const cat=dc,proj=dp;if(!cat||!proj)return null;const at=[];proj.subprojects.forEach(s=>s.tasks.forEach(t=>at.push(t)));const d=at.filter(t=>t.done).length;const p=at.length?(d/at.length)*100:0;
    return <div>{mo&&<Mo {...mo} onClose={()=>sMo(null)}/>}
      <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:12}}><div onClick={()=>setDetail(null)} style={{fontSize:11,color:"#555",cursor:"pointer"}}>‚Üê Back</div><Bt onClick={()=>sMo({title:`${cat.name} ‚Ä∫ ${proj.name}`,content:eP(cat,proj)})}>‚Üó Export</Bt></div>
      <div style={{background:css.card,border:"1px solid "+css.bdr,borderRadius:12,padding:18,borderTop:`3px solid ${cat.color}`,marginBottom:16}}>
        <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start"}}><div><div style={{fontSize:10,color:cat.color,fontWeight:650,letterSpacing:1.2,textTransform:"uppercase"}}>{cat.name}</div><div style={{fontSize:18,fontWeight:700,color:"#e8e8ef"}}>{proj.name}</div><div style={{fontSize:11,color:"#777",marginTop:3}}>{proj.statusText}</div><Tags tags={proj.tags}/></div>
          <div style={{display:"flex",gap:4,flexWrap:"wrap",alignItems:"flex-start"}}><TP tags={proj.tags||[]} onChange={t=>uProj(cat.id,proj.id,p=>({...p,tags:t}))} people={people}/>{Object.entries(ST).map(([k,v])=><div key={k} onClick={()=>setData(d=>d.map(c=>c.id!==cat.id?c:{...c,projects:c.projects.map(q=>q.id!==proj.id?q:{...q,status:k})}))} style={{fontSize:9,padding:"3px 7px",borderRadius:5,cursor:"pointer",fontWeight:650,background:proj.status===k?v.c+"28":"#141420",color:proj.status===k?v.c:"#444",border:`1px solid ${proj.status===k?v.c+"40":css.bdr}`}}>{v.l}</div>)}</div></div>
        <div style={{display:"flex",gap:10,marginTop:10,fontSize:10,color:"#555",alignItems:"center",flexWrap:"wrap"}}><span>Start:</span><In type="date" value={proj.startDate} onChange={e=>uProj(cat.id,proj.id,p=>({...p,startDate:e.target.value}))} style={{fontSize:10,padding:"3px 6px"}}/><span>End:</span><In type="date" value={proj.endDate} onChange={e=>uProj(cat.id,proj.id,p=>({...p,endDate:e.target.value}))} style={{fontSize:10,padding:"3px 6px"}}/><span>Timeline:</span><IE value={proj.timeline} onSave={n=>uProj(cat.id,proj.id,p=>({...p,timeline:n}))} style={{color:"#999",fontWeight:600}}/></div>
        <div style={{display:"flex",alignItems:"center",gap:10,marginTop:10}}><Br p={p} color={cat.color} h={5}/><span style={{fontSize:11,color:"#888"}}>{Math.round(p)}%</span></div>
        </div>
      <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:10}}><span style={{fontSize:10,fontWeight:650,letterSpacing:1.5,textTransform:"uppercase",color:"#777"}}>Sub-projects ({proj.subprojects.length})</span><span onClick={()=>{sASP(!aSP);sSD(proj.startDate);sED(proj.endDate)}} style={{fontSize:10,color:cat.color,cursor:"pointer",fontWeight:600}}>+ Sub-project</span></div>
      {aSP&&<div style={{display:"flex",gap:6,marginBottom:10,flexWrap:"wrap"}}><In value={spN} onChange={e=>sSN(e.target.value)} placeholder="Name..." style={{flex:1,minWidth:120}}/><In type="date" value={spSD} onChange={e=>sSD(e.target.value)} style={{width:130}}/><In type="date" value={spED} onChange={e=>sED(e.target.value)} style={{width:130}}/><Bt accent={cat.color} onClick={()=>{if(!spN.trim())return;setData(x=>x.map(c=>c.id!==cat.id?c:{...c,projects:c.projects.map(q=>q.id!==proj.id?q:{...q,subprojects:[...q.subprojects,{id:uid(),name:spN.trim(),tags:[],notes:"",attachments:[],startDate:spSD,endDate:spED,tasks:[]}]})}));sSN("");sASP(false)}}>Add</Bt></div>}
      {proj.subprojects.map(sp=>{const sd=sp.tasks.filter(t=>t.done).length;const spp=sp.tasks.length?(sd/sp.tasks.length)*100:0;
        return <div key={sp.id} style={{background:css.card,border:"1px solid "+css.bdr,borderRadius:10,marginBottom:8,borderLeft:`2px solid ${cat.color}50`}}>
          <div style={{display:"flex",alignItems:"center",gap:8,padding:"10px 14px",background:"#0e0e16",flexWrap:"wrap"}}><span style={{fontSize:12,fontWeight:600,color:"#c0c0cc",flex:1}}>{sp.name}</span><Tags tags={sp.tags} small/><TP tags={sp.tags||[]} onChange={t=>uSP(cat.id,proj.id,sp.id,s=>({...s,tags:t}))} people={people}/><div style={{width:50}}><Br p={spp} color={cat.color} h={2}/></div><span style={{fontSize:9,color:"#555"}}>{sd}/{sp.tasks.length}</span></div>
          <div style={{padding:"4px 14px",display:"flex",gap:8,alignItems:"center",fontSize:9,color:"#555",flexWrap:"wrap"}}><span>Start:</span><In type="date" value={sp.startDate||""} onChange={e=>uSP(cat.id,proj.id,sp.id,s=>({...s,startDate:e.target.value}))} style={{fontSize:9,padding:"2px 4px"}}/><span>End:</span><In type="date" value={sp.endDate||""} onChange={e=>uSP(cat.id,proj.id,sp.id,s=>({...s,endDate:e.target.value}))} style={{fontSize:9,padding:"2px 4px"}}/></div>
          <div style={{padding:"2px 14px"}}><NP notes={sp.notes} attachments={sp.attachments||[]} onNotesChange={n=>uSP(cat.id,proj.id,sp.id,s=>({...s,notes:n}))} onAddAttachment={a=>uSP(cat.id,proj.id,sp.id,s=>({...s,attachments:[...(s.attachments||[]),a]}))} onRemoveAttachment={i=>uSP(cat.id,proj.id,sp.id,s=>({...s,attachments:(s.attachments||[]).filter((_,j)=>j!==i)}))}/></div>
          <div style={{padding:"6px 14px 10px 28px"}}>
            {sp.tasks.map(t=><div key={t.id} style={{opacity:t.done?.4:1,marginBottom:2}}>
              <div style={{display:"flex",alignItems:"center",gap:8,padding:"5px 0"}}><Ch on={t.done} color={cat.color} onClick={()=>tog(cat.id,proj.id,sp.id,t.id)}/><span style={{flex:1,fontSize:11.5,color:t.done?"#555":"#c8c8d4",textDecoration:t.done?"line-through":"none"}}>{t.text}</span><Tags tags={t.tags} small/><TP tags={t.tags||[]} onChange={tg=>uTask(cat.id,proj.id,sp.id,t.id,x=>({...x,tags:tg}))} people={people}/><In type="date" value={t.due} onChange={e=>uTask(cat.id,proj.id,sp.id,t.id,x=>({...x,due:e.target.value}))} style={{width:120,fontSize:9,padding:"2px 4px"}}/><B bg={PR[t.priority].c+"1a"} color={PR[t.priority].c}>{PR[t.priority].l}</B><Du due={t.due} done={t.done}/><DB onConfirm={()=>dT(cat.id,proj.id,sp.id,t.id)}/></div>
              <div style={{paddingLeft:25}}><NP notes={t.notes} attachments={t.attachments||[]} onNotesChange={n=>uTask(cat.id,proj.id,sp.id,t.id,x=>({...x,notes:n}))} onAddAttachment={a=>uTask(cat.id,proj.id,sp.id,t.id,x=>({...x,attachments:[...(x.attachments||[]),a]}))} onRemoveAttachment={i=>uTask(cat.id,proj.id,sp.id,t.id,x=>({...x,attachments:(x.attachments||[]).filter((_,j)=>j!==i)}))}/></div></div>)}
            {aT===sp.id?<div style={{display:"flex",gap:5,marginTop:6,alignItems:"center",flexWrap:"wrap"}}><In value={tN} onChange={e=>sTN(e.target.value)} placeholder="Task..." style={{flex:1,minWidth:140}} onKeyDown={e=>{if(e.key==="Enter"&&tN.trim()){setData(x=>x.map(c=>c.id!==cat.id?c:{...c,projects:c.projects.map(q=>q.id!==proj.id?q:{...q,subprojects:q.subprojects.map(s=>s.id!==sp.id?s:{...s,tasks:[...s.tasks,{id:uid(),text:tN.trim(),done:false,priority:tP,due:tDu,tags:tTg,notes:"",attachments:[]}]})})}));sTN("");sAT(null)}}}/><Se value={tP} onChange={e=>sTP(e.target.value)}><option value="high">High</option><option value="medium">Med</option><option value="low">Low</option></Se><In type="date" value={tDu} onChange={e=>sTD(e.target.value)} style={{width:130}}/><TP tags={tTg} onChange={t=>sTTg(t)} people={people}/><Bt accent={cat.color} onClick={()=>{if(!tN.trim())return;setData(x=>x.map(c=>c.id!==cat.id?c:{...c,projects:c.projects.map(q=>q.id!==proj.id?q:{...q,subprojects:q.subprojects.map(s=>s.id!==sp.id?s:{...s,tasks:[...s.tasks,{id:uid(),text:tN.trim(),done:false,priority:tP,due:tDu,tags:tTg,notes:"",attachments:[]}]})})}));sTN("");sAT(null)}}>Add</Bt><span onClick={()=>sAT(null)} style={{color:"#555",cursor:"pointer"}}>‚úï</span></div>
            :<div onClick={()=>sAT(sp.id)} style={{fontSize:10,color:"#444",cursor:"pointer",marginTop:4}}>+ Add task</div>}</div></div>})}</div>}
  return <div style={{background:css.bg,minHeight:"100vh",color:"#e8e8ef",fontFamily:"'DM Sans','Helvetica Neue',sans-serif",userSelect:drag?"none":"auto"}}>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet"/>
    <div style={{padding:"16px 20px 0",borderBottom:"1px solid #14141e"}}>
      <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12}}>
        <div><div style={{fontSize:18,fontWeight:700,letterSpacing:-.5}}><span style={{color:"#e94560"}}>3LA</span> <span style={{color:"#555",fontWeight:400}}>PM</span></div><div style={{fontSize:10,color:"#444",marginTop:1}}>Week of {(()=>{const d=new Date();const day=d.getDay();const diff=d.getDate()-day+(day===0?-6:1);d.setDate(diff);return d.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})()}</div></div>
        <div style={{display:"flex",gap:10,alignItems:"center"}}>
          <PM people={people} setPeople={setPeople}/>
          <Bt sx={{padding:"4px 8px",fontSize:9}} onClick={()=>{if(confirm("Reset all data to defaults?")){setData(INIT);setPeople(PEOPLE)}}}>‚Ü∫</Bt>
          <div style={{display:"flex",gap:14,alignItems:"center"}}><div style={{textAlign:"center"}}><div style={{fontSize:18,fontWeight:700,color:urg>0?"#f5a623":"#0f9b8e"}}>{urg}</div><div style={{fontSize:8,color:"#555",letterSpacing:1.2,fontWeight:600}}>URGENT</div></div><div style={{width:1,height:24,background:css.bdr}}/><div style={{textAlign:"center"}}><div style={{fontSize:18,fontWeight:700}}>{dn}<span style={{color:"#444",fontWeight:400}}>/{tot}</span></div><div style={{fontSize:8,color:"#555",letterSpacing:1.2,fontWeight:600}}>TASKS</div></div></div></div></div>
      <div style={{display:"flex"}}>
        {VW.map(v=><div key={v.k} onClick={()=>{setView(v.k);setDetail(null)}} style={{padding:"7px 14px",cursor:"pointer",fontSize:11.5,fontWeight:view===v.k&&!detail?650:400,color:view===v.k&&!detail?"#e8e8ef":"#555",borderBottom:view===v.k&&!detail?"2px solid #e94560":"2px solid transparent",display:"flex",alignItems:"center",gap:4}}><span style={{fontSize:11}}>{v.i}</span> {v.l}</div>)}
        <div style={{flex:1}}/>
        <div onClick={()=>setShowAdd(!showAdd)} style={{padding:"7px 12px",cursor:"pointer",fontSize:11.5,fontWeight:650,color:"#e94560",display:"flex",alignItems:"center",gap:3}}><span style={{fontSize:15,lineHeight:1}}>+</span> Task</div></div></div>
    {showAdd&&<div style={{padding:"10px 20px",background:"#0e0e16",borderBottom:"1px solid #14141e"}}><div style={{display:"flex",gap:6,alignItems:"center",flexWrap:"wrap"}}><In value={af.text} onChange={e=>setAf({...af,text:e.target.value})} placeholder="Task..." style={{flex:1,minWidth:160}} onKeyDown={e=>e.key==="Enter"&&doAdd()}/><Se value={af.catId} onChange={e=>setAf({...af,catId:e.target.value,projId:"",spId:""})}><option value="">Category...</option>{data.map(c=><option key={c.id} value={c.id}>{c.name}</option>)}</Se><Se value={af.projId} onChange={e=>setAf({...af,projId:e.target.value,spId:""})}><option value="">Project...</option>{scp.map(p=><option key={p.id} value={p.id}>{p.name}</option>)}</Se><Se value={af.spId} onChange={e=>setAf({...af,spId:e.target.value})}><option value="">Sub-project...</option>{sps.map(s=><option key={s.id} value={s.id}>{s.name}</option>)}</Se><Se value={af.priority} onChange={e=>setAf({...af,priority:e.target.value})}><option value="high">High</option><option value="medium">Med</option><option value="low">Low</option></Se><In type="date" value={af.due} onChange={e=>setAf({...af,due:e.target.value})} style={{width:130}}/><TP tags={af.tags||[]} onChange={t=>setAf({...af,tags:t})} people={people}/><Bt accent="#e94560" onClick={doAdd}>Add</Bt></div></div>}
    <div style={{padding:"14px 20px 40px"}}>{detail?<DV/>:view==="status"?<SV/>:view==="tasks"?<TV/>:view==="reminders"?<RV/>:<GV/>}</div></div>;
}
